<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional vCard QR Code Generator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f9;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            display: flex;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 100%;
        }
        .form-section, .qr-section {
            padding: 30px;
        }
        .form-section {
            flex: 2;
            border-right: 1px solid #eee;
        }
        .qr-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            background-color: #fafafa;
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8em;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        input:focus {
            border-color: #3498db;
            outline: none;
        }
        input.required-field {
            border-left: 4px solid #e74c3c;
        }
        .generate-btn {
            background-color: #3498db; /* Blue for Generate */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        .generate-btn:hover {
            background-color: #2980b9;
        }
        .download-btn {
            background-color: #2ecc71; /* Green for Download */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
            width: 80%; /* Smaller than generate button */
            margin-top: 15px;
            display: none; /* Hide until QR code is generated */
        }
        .download-btn:hover {
            background-color: #27ae60;
        }
        #qrcode {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .instruction {
            margin-top: 15px;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        .error-message {
            color: #e74c3c;
            margin-bottom: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        
        <div class="form-section">
            <h1>Contact Card Details ðŸ‘¤</h1>
            <p class="instruction">The fields **Name, Email, and Phone** are required to generate the vCard.</p>

            <div id="errorMessage" class="error-message" style="display: none;"></div>

            <label for="name">Name <span style="color:red;">*</span></label>
            <input type="text" id="name" class="required-field" required>

            <label for="email">Email <span style="color:red;">*</span></label>
            <input type="text" id="email" class="required-field" required>

            <label for="phone">Phone <span style="color:red;">*</span></label>
            <input type="text" id="phone" class="required-field" required>

            <label for="organization">Organization</label>
            <input type="text" id="organization">

            <label for="address">Address</label>
            <input type="text" id="address" placeholder="Street;City;State;Zip;Country">

            <label for="website">Website URL (e.g., https://yourdomain.com)</label>
            <input type="text" id="website">
            
            <label for="instagram">Instagram Handle</label>
            <input type="text" id="instagram" placeholder="@handle">
            
            <label for="facebook">Facebook Profile URL</label>
            <input type="text" id="facebook">
            
            <label for="tiktok">TikTok Handle</label>
            <input type="text" id="tiktok" placeholder="@handle">

            <button onclick="generateQRCode()" class="generate-btn">Generate QR Code</button>
        </div>

        <div class="qr-section">
            <h2>Your QR Code Preview</h2>
            <div id="qrcode"></div>
            
            <button id="downloadButton" onclick="triggerDownload()" class="download-btn">Download QR Code (PNG)</button>
            <p class="instruction">Scan the code above to test it, then click 'Download' to save the file.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // --- Global Variables ---
        const qrCodeDiv = document.getElementById("qrcode");
        const errorMessageDiv = document.getElementById("errorMessage");
        const downloadButton = document.getElementById("downloadButton");
        let qr = null; // Holds the QRCode object

        // Function to safely get a trimmed value, or an empty string
        const getValue = (id) => document.getElementById(id).value.trim();

        // --- Core vCard Generation Logic ---
        function generateVCardData() {
            // Get all field values
            const name = getValue('name');
            const email = getValue('email');
            const phone = getValue('phone');
            const organization = getValue('organization');
            const address = getValue('address');
            const website = getValue('website');
            const instagram = getValue('instagram');
            const facebook = getValue('facebook');
            const tiktok = getValue('tiktok');

            // 1. Minimum Required Check
            if (!name || !email || !phone) {
                errorMessageDiv.textContent = "Please fill in the Name, Email, and Phone fields.";
                errorMessageDiv.style.display = 'block';
                return null;
            }
            errorMessageDiv.style.display = 'none';

            // 2. Build the vCard String (v3.0)
            let vCard = `BEGIN:VCARD\nVERSION:3.0\n`;
            
            vCard += `FN:${name}\n`;
            vCard += `N:;${name};;;\n`; 

            if (organization) vCard += `ORG:${organization}\n`;

            vCard += `TEL;TYPE=CELL:${phone}\n`;

            vCard += `EMAIL;TYPE=INTERNET:${email}\n`;

            if (address) vCard += `ADR;TYPE=WORK:;;${address}\n`; 

            if (website) vCard += `URL:${website}\n`;

            // Social Media in NOTE field
            const socialMedia = [];
            if (instagram) socialMedia.push(`Instagram: ${instagram}`);
            if (facebook) socialMedia.push(`Facebook: ${facebook}`);
            if (tiktok) socialMedia.push(`TikTok: ${tiktok}`);

            if (socialMedia.length > 0) {
                vCard += `NOTE:${socialMedia.join('\\n')}\n`;
            }

            vCard += `END:VCARD`;

            return vCard;
        }

        /**
         * Generates and displays the QR code, then enables the download button.
         */
        function generateQRCode() {
            const vCardData = generateVCardData();
            if (!vCardData) return; // Exit if required fields are missing

            // Initialize QRCode object if it doesn't exist
            if (!qr) {
                qr = new QRCode(qrCodeDiv, {
                    width: 256,
                    height: 256,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }
            
            // Generate the QR Code
            qr.makeCode(vCardData);
            
            // Show the download button now that the code is visible
            downloadButton.style.display = 'block'; 
        }

        /**
         * Triggers the download of the currently displayed QR code image.
         */
        function triggerDownload() {
            // Ensure the code has been generated
            if (!qr) {
                alert("Please generate the QR Code first.");
                return;
            }

            // Wait a moment for the canvas to draw (essential for reliable download)
            setTimeout(() => {
                // 1. Get the Canvas element created by qrcode.js
                // qrcode.js wraps the canvas in a div, so we access the first child
                const canvas = qrCodeDiv.querySelector('canvas');

                if (!canvas) {
                     alert("QR Code image not found.");
                     return;
                }

                // 2. Convert the Canvas content to a Data URL (PNG image format)
                const imageURL = canvas.toDataURL("image/png");

                // 3. Create a temporary <a> element to trigger the download
                const downloadLink = document.createElement('a');
                downloadLink.href = imageURL;
                downloadLink.download = 'vcard_qr_code.png';

                // 4. Simulate a click to download
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                console.log("Download initiated.");

            }, 50); 
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set default values for quick testing
            document.getElementById('name').value = "Jane Doe";
            document.getElementById('email').value = "jane.doe@work.com";
            document.getElementById('phone').value = "+44 20 7946 0884";
            
            // Generate the initial code on load
            generateQRCode();
        });
    </script>

</body>
</html>
